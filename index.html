<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCWorld Forum</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }

        /* === THEME VARS: 2023 default === */
        :root {
            --accent:#22c55e; --accent-dark:#16a34a;
            --bg:#0f172a; --bg2:#1e293b; --bg3:#334155;
            --card:#1e293b; --border:#334155;
            --text:#f1f5f9; --text2:#94a3b8;
            --red:#ef4444; --yellow:#f59e0b; --gold:#fbbf24;
            --font:'Nunito',sans-serif;
            --radius:8px; --btn-radius:6px;
            --header-bg:linear-gradient(135deg,#0f172a 0%,#1e3a1e 50%,#0f172a 100%);
            --header-border:#22c55e;
            --nav-bg:#1e293b;
            --section-bg:linear-gradient(90deg,#16a34a,#15803d);
            --post-header-bg:rgba(34,197,94,0.06);
            --reply-bg:rgba(15,23,42,0.5);
            --reply-form-bg:rgba(15,23,42,0.4);
        }

        /* === THEME: 2016 === */
        body.t2016 {
            --accent:#5aad14; --accent-dark:#3a8c00;
            --bg:#557755; --bg2:#2d2d2d; --bg3:#555;
            --card:#f0f0e8; --border:#999;
            --text:#111; --text2:#555;
            --red:#cc3333; --yellow:#cc9933; --gold:#b8860b;
            --font:Verdana,Arial,sans-serif;
            --radius:2px; --btn-radius:2px;
            --header-bg:linear-gradient(180deg,#1a7a1a,#0d4d0d);
            --header-border:#5aad14;
            --nav-bg:#2d2d2d;
            --section-bg:linear-gradient(180deg,#3a8c14,#1e5a00);
            --post-header-bg:linear-gradient(180deg,#e8f5e0,#d0e8c0);
            --reply-bg:#f4f8f0;
            --reply-form-bg:#eef4e8;
        }
        body.t2016 .forum-header h1 {
            font-family:Impact,"Arial Black",sans-serif;
            font-size:36px; letter-spacing:4px;
            text-shadow:3px 3px 0 #000,-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000;
        }
        body.t2016 input[type="text"],body.t2016 input[type="password"],body.t2016 textarea,body.t2016 select {
            background:#fff; color:#111; border:2px inset #ccc;
        }
        body.t2016 .modal-box { background:#f0f0e8; color:#111; }
        body.t2016 .profile-card { background:#f8f8f0; }
        body.t2016 .btn { border:2px outset #ccc; }

        /* === THEME: 2019 === */
        body.t2019 {
            --accent:#1abc9c; --accent-dark:#16a085;
            --bg:#1a1a2e; --bg2:#16213e; --bg3:#0f3460;
            --card:#16213e; --border:#0f3460;
            --text:#eee; --text2:#8aa;
            --red:#e74c3c; --yellow:#f39c12; --gold:#f1c40f;
            --font:'Segoe UI',Tahoma,sans-serif;
            --radius:4px; --btn-radius:4px;
            --header-bg:linear-gradient(135deg,#1a1a2e,#0f3460);
            --header-border:#1abc9c;
            --nav-bg:#16213e;
            --section-bg:linear-gradient(90deg,#16a085,#1abc9c);
            --post-header-bg:rgba(26,188,156,0.08);
            --reply-bg:rgba(0,0,0,0.2);
            --reply-form-bg:rgba(0,0,0,0.15);
        }

        /* === THEME: 2025 === */
        body.t2025 {
            --accent:#818cf8; --accent-dark:#6366f1;
            --bg:#09090b; --bg2:#18181b; --bg3:#27272a;
            --card:#18181b; --border:#3f3f46;
            --text:#fafafa; --text2:#a1a1aa;
            --red:#f43f5e; --yellow:#eab308; --gold:#f59e0b;
            --font:'Nunito',sans-serif;
            --radius:12px; --btn-radius:8px;
            --header-bg:linear-gradient(135deg,#09090b,#1e1b4b,#09090b);
            --header-border:#6366f1;
            --nav-bg:#18181b;
            --section-bg:linear-gradient(90deg,#4f46e5,#818cf8);
            --post-header-bg:rgba(99,102,241,0.08);
            --reply-bg:rgba(0,0,0,0.2);
            --reply-form-bg:rgba(0,0,0,0.15);
        }
        body.t2025 .role-owner {
            background:linear-gradient(90deg,#6366f1,#818cf8,#6366f1);
            color:#fff; border-color:#4f46e5;
        }

        /* === BASE === */
        body {
            background:var(--bg); font-family:var(--font);
            font-size:13px; color:var(--text); min-height:100vh;
        }
        a { color:var(--accent); text-decoration:none; cursor:pointer; }
        a:hover { text-decoration:underline; }

        .forum-header {
            background:var(--header-bg);
            border-bottom:2px solid var(--header-border);
            padding:16px 0 12px; text-align:center;
        }
        .forum-header h1 { font-size:32px; font-weight:800; color:#fff; letter-spacing:2px; }
        .forum-header h1 span { color:var(--accent); }
        .forum-header .sub { font-size:11px; color:var(--text2); margin-top:4px; font-family:'JetBrains Mono',monospace; letter-spacing:3px; }

        .navbar {
            background:var(--nav-bg); border-bottom:1px solid var(--border);
            padding:0 16px; display:flex; justify-content:space-between;
            align-items:center; flex-wrap:wrap; position:sticky; top:0; z-index:100;
        }
        .nav-links a {
            padding:10px 14px; color:var(--text2) !important;
            display:inline-block; font-size:12px; font-weight:700; transition:all .15s;
        }
        .nav-links a:hover { color:var(--accent) !important; text-decoration:none; background:rgba(255,255,255,.05); }
        .nav-right { padding:0 8px; display:flex; align-items:center; gap:10px; }
        .user-info { color:var(--accent); font-weight:700; font-size:12px; }
        #nav-logout { color:var(--red) !important; font-size:12px; }

        .wrapper { max-width:900px; margin:16px auto; padding:0 12px; }

        .sec-hdr {
            background:var(--section-bg); color:#fff;
            padding:8px 14px; font-weight:800; font-size:13px;
            border-radius:var(--radius) var(--radius) 0 0;
            margin-top:12px;
        }
        .sec-hdr.alone { border-radius:var(--radius); }

        .card {
            background:var(--card); border:1px solid var(--border);
            border-radius:0 0 var(--radius) var(--radius);
            padding:16px; margin-bottom:12px;
        }
        .card.alone { border-radius:var(--radius); margin:12px 0; }
        .card h2 { font-size:14px; color:var(--accent); margin-bottom:12px; border-bottom:1px solid var(--border); padding-bottom:6px; font-weight:800; }

        .row { margin:8px 0; display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
        .row label { font-weight:700; font-size:12px; color:var(--text2); min-width:110px; }

        input[type="text"],input[type="password"],textarea,select {
            background:var(--bg); border:1px solid var(--border);
            border-radius:var(--btn-radius); padding:6px 10px;
            font-family:var(--font); font-size:12px; color:var(--text); outline:none; transition:border .15s;
        }
        input[type="text"]:focus,input[type="password"]:focus,textarea:focus,select:focus { border-color:var(--accent); }
        input[type="text"],input[type="password"] { width:200px; }
        textarea { width:100%; height:80px; resize:vertical; }
        select { padding:5px 8px; cursor:pointer; }
        input[type="file"] { color:var(--text2); font-size:11px; }

        /* BUTTONS - clean, no emoji */
        .btn {
            font-family:var(--font); font-size:12px; padding:6px 16px;
            cursor:pointer; border-radius:var(--btn-radius); border:none;
            font-weight:700; transition:filter .15s;
            background:var(--bg3); color:var(--text);
        }
        .btn:hover { filter:brightness(1.15); }
        .btn.sm { padding:3px 10px; font-size:11px; }
        .btn-green { background:var(--accent); color:#fff; }
        .btn-red { background:var(--red); color:#fff; }
        .btn-yellow { background:var(--yellow); color:#111; }
        .btn-teal { background:var(--accent-dark); color:#fff; }

        /* ROLE BADGES */
        .rb { font-size:10px; font-weight:700; padding:2px 7px; border-radius:4px; display:inline-block; margin-left:4px; }
        .rb-player { color:#94a3b8; background:rgba(148,163,184,.12); border:1px solid #475569; }
        .rb-vip { color:var(--gold); background:rgba(251,191,36,.12); border:1px solid #92400e; }
        .rb-moder { color:#4ade80; background:rgba(74,222,128,.12); border:1px solid #166534; }
        .rb-admin { color:#f87171; background:rgba(248,113,113,.12); border:1px solid #991b1b; }
        .rb-coowner { color:#c084fc; background:rgba(192,132,252,.12); border:1px solid #7e22ce; }
        .rb-owner { color:#1a0a00; background:linear-gradient(90deg,#fbbf24,#f59e0b,#fbbf24); border:1px solid #b45309; box-shadow:0 0 6px #fbbf2444; }

        /* POSTS */
        .post { background:var(--card); border:1px solid var(--border); border-radius:var(--radius); margin:8px 0; overflow:hidden; }
        .post-hdr { background:var(--post-header-bg); padding:8px 12px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center; }
        .post-title { font-weight:800; font-size:13px; color:var(--accent); }
        .post-meta { font-size:10px; color:var(--text2); display:flex; align-items:center; gap:6px; }
        .post-body { padding:10px 12px; font-size:12px; line-height:1.6; white-space:pre-wrap; word-wrap:break-word; }
        .post-author { display:flex; gap:8px; align-items:center; }
        .post-author-name { font-weight:700; color:var(--text); }
        .post-media { padding:6px 12px; }
        .post-media img { max-width:400px; max-height:300px; border-radius:var(--radius); border:1px solid var(--border); cursor:pointer; }
        .post-media video { max-width:400px; max-height:300px; border-radius:var(--radius); border:1px solid var(--border); }

        .av-sm { width:26px; height:26px; border-radius:4px; border:1px solid var(--border); object-fit:cover; vertical-align:middle; }
        .av-lg { width:80px; height:80px; border-radius:var(--radius); border:2px solid var(--border); object-fit:cover; }

        .replies { border-top:1px solid var(--border); }
        .reply { padding:6px 12px 6px 28px; border-bottom:1px solid rgba(255,255,255,.05); background:var(--reply-bg); font-size:12px; }
        .reply:last-child { border-bottom:none; }
        .reply-form { padding:6px 12px; background:var(--reply-form-bg); display:flex; gap:6px; }
        .reply-form input { flex:1; }

        /* TABS */
        .tabs { display:flex; gap:4px; margin-top:12px; }
        .tab { background:var(--bg2); border:1px solid var(--border); border-bottom:none; border-radius:var(--radius) var(--radius) 0 0; padding:7px 18px; font-size:12px; font-weight:700; cursor:pointer; color:var(--text2); font-family:var(--font); transition:all .15s; }
        .tab:hover { color:var(--accent); }
        .tab.on { background:var(--card); color:var(--accent); }
        .panel { display:none; }
        .panel.on { display:block; }

        /* SETTINGS THEMES */
        .theme-grid { display:flex; gap:12px; flex-wrap:wrap; margin-top:10px; }
        .tc {
            border:2px solid var(--border); border-radius:var(--radius);
            padding:14px 22px; cursor:pointer; text-align:center;
            transition:all .2s; min-width:110px;
        }
        .tc:hover { border-color:var(--accent); }
        .tc.on { border-color:var(--accent); background:rgba(255,255,255,.06); }
        .tc .yr { font-size:22px; font-weight:800; display:block; margin-bottom:4px; }
        .tc .ds { font-size:10px; color:var(--text2); font-weight:400; }
        .tc-2016 .yr { color:#5aad14; }
        .tc-2019 .yr { color:#1abc9c; }
        .tc-2023 .yr { color:#22c55e; }
        .tc-2025 .yr { color:#818cf8; }

        /* ADMIN */
        .adm-row { display:flex; align-items:center; gap:6px; padding:7px 0; border-bottom:1px solid var(--border); flex-wrap:wrap; }
        .adm-row:last-child { border-bottom:none; }
        .bs { font-size:10px; padding:2px 6px; border-radius:4px; font-weight:700; }
        .bs-ban { background:rgba(239,68,68,.2); color:#f87171; border:1px solid #991b1b; }
        .bs-mute { background:rgba(245,158,11,.2); color:#fbbf24; border:1px solid #92400e; }

        /* PROFILE */
        .prof-card { background:var(--card); border:1px solid var(--border); border-radius:0 0 var(--radius) var(--radius); padding:16px; display:flex; gap:20px; align-items:flex-start; }
        .prof-info { flex:1; }
        .prof-info p { margin:5px 0; font-size:12px; color:var(--text2); }
        .prof-info p b { color:var(--text); }
        .danger { border:1px solid #7f1d1d; background:rgba(239,68,68,.05); border-radius:var(--radius); padding:14px; margin:8px 0; }
        .danger h2 { color:#f87171 !important; border-color:#7f1d1d !important; }

        /* STATUS */
        .status { padding:8px 14px; font-size:12px; margin:8px 0; display:none; border-radius:var(--radius); font-weight:700; }
        .status.err { background:rgba(239,68,68,.15); color:#f87171; border:1px solid #991b1b; }
        .status.ok { background:rgba(34,197,94,.15); color:#4ade80; border:1px solid #166534; }
        .status.show { display:block; }
        .empty { font-size:12px; color:var(--text2); text-align:center; padding:12px; }

        /* LIGHTBOX */
        .lbx { display:none; position:fixed; inset:0; background:rgba(0,0,0,.9); z-index:999; align-items:center; justify-content:center; cursor:pointer; }
        .lbx.on { display:flex; }
        .lbx img { max-width:90vw; max-height:90vh; border-radius:var(--radius); }

        /* MODAL */
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.7); z-index:998; align-items:center; justify-content:center; }
        .modal.on { display:flex; }
        .modal-box { background:var(--bg2); border:1px solid var(--border); border-radius:calc(var(--radius) + 2px); padding:24px; max-width:360px; width:90%; text-align:center; }
        .modal-box h3 { font-size:16px; margin-bottom:10px; color:var(--red); }
        .modal-box p { font-size:12px; color:var(--text2); margin-bottom:16px; }
        .modal-btns { display:flex; gap:10px; justify-content:center; }

        /* FOOTER */
        .footer { background:var(--bg2); color:var(--text2); text-align:center; padding:10px; font-size:11px; border-top:1px solid var(--border); margin-top:20px; }
        .footer span { color:var(--accent); }
    </style>
</head>
<body>

<div class="forum-header">
    <h1>MC<span>World</span></h1>
    <div class="sub">:: MINECRAFT COMMUNITY FORUM :: 2026 ::</div>
</div>

<div class="navbar">
    <div class="nav-links">
        <a onclick="go('home')">Главная</a>
        <a onclick="go('forum')" id="nav-forum" style="display:none">Форум</a>
        <a onclick="go('search')" id="nav-search" style="display:none">Поиск</a>
        <a onclick="go('profile')" id="nav-profile" style="display:none">Профиль</a>
        <a onclick="go('settings')" id="nav-settings" style="display:none">Настройки</a>
        <a onclick="go('admin')" id="nav-admin" style="display:none">Админ</a>
    </div>
    <div class="nav-right">
        <span id="nav-info" class="user-info" style="display:none"></span>
        <a onclick="doLogout()" id="nav-logout" style="display:none;color:var(--red)">[Выход]</a>
    </div>
</div>

<div class="wrapper">
    <div class="status" id="status"></div>

    <!-- ГЛАВНАЯ -->
    <div id="page-home">
        <div class="sec-hdr">Добро пожаловать на MCWorld Forum!</div>
        <div class="card">
            <h2>История Minecraft</h2>
            <p style="font-size:12px;line-height:1.8;color:var(--text2)">
                <b style="color:var(--text)">Minecraft</b> — легендарная песочница, созданная
                <b style="color:var(--text)">Маркусом "Notch" Перссоном</b> в 2009 году.
                В 2011 году вышла версия 1.0, в 2014 Microsoft купила Mojang за
                <b style="color:var(--accent)">2.5 млрд долларов</b>.
                Сейчас это самая продаваемая игра в истории —
                <b style="color:var(--accent)">300+ миллионов</b> копий.
            </p>
        </div>
        <div class="card alone">
            <h2>История этого сайта</h2>
            <p style="font-size:12px;line-height:1.8;color:var(--text2)">
                Форум создан <b style="color:var(--text)">20 февраля 2026 года</b> в ~22:00.
                Автору было скучно — за один вечер родился <b style="color:var(--accent)">MCWorld Forum</b>.<br><br>
                <i>"Когда скучно — программируй. Так рождаются великие вещи."</i>
            </p>
        </div>
    </div>

    <!-- АВТОРИЗАЦИЯ -->
    <div id="page-auth" style="display:none">
        <div class="tabs">
            <div class="tab on" id="tab-login" onclick="switchTab('login')">Вход</div>
            <div class="tab" id="tab-reg" onclick="switchTab('reg')">Регистрация</div>
        </div>
        <div class="panel on" id="panel-login">
            <div class="card">
                <h2>Вход на форум</h2>
                <div class="row"><label>Логин:</label><input type="text" id="login-u" maxlength="20"></div>
                <div class="row"><label>Пароль:</label><input type="password" id="login-p" maxlength="50" onkeydown="if(event.key==='Enter')doLogin()"></div>
                <div class="row" style="margin-top:10px"><label></label><button class="btn btn-green" onclick="doLogin()">Войти</button></div>
            </div>
        </div>
        <div class="panel" id="panel-reg">
            <div class="card">
                <h2>Регистрация</h2>
                <div class="row"><label>Логин:</label><input type="text" id="reg-u" maxlength="20"></div>
                <div class="row"><label>Пароль:</label><input type="password" id="reg-p" maxlength="50"></div>
                <div class="row"><label>Повтор:</label><input type="password" id="reg-p2" maxlength="50" onkeydown="if(event.key==='Enter')doRegister()"></div>
                <div class="row" style="margin-top:10px"><label></label><button class="btn btn-green" onclick="doRegister()">Зарегистрироваться</button></div>
            </div>
        </div>
    </div>

    <!-- ФОРУМ -->
    <div id="page-forum" style="display:none">
        <div class="sec-hdr">Новая тема</div>
        <div class="card" id="new-post-form">
            <div class="row"><label>Заголовок:</label><input type="text" id="post-title" maxlength="100" style="width:calc(100% - 120px)"></div>
            <div class="row" style="align-items:flex-start"><label style="padding-top:6px">Сообщение:</label><textarea id="post-content" style="flex:1"></textarea></div>
            <div class="row"><label>Медиафайл:</label><input type="file" id="post-media" accept="image/*,video/*"></div>
            <div class="row" style="margin-top:8px"><label></label><button class="btn btn-green" onclick="doPost()">Отправить</button></div>
        </div>
        <div class="sec-hdr">Темы форума</div>
        <div id="posts-list"><div class="empty">Загрузка...</div></div>
    </div>

    <!-- ПРОФИЛЬ -->
    <div id="page-profile" style="display:none">
        <div class="sec-hdr">Мой профиль</div>
        <div class="prof-card">
            <div style="text-align:center">
                <img id="prof-av" class="av-lg" src="" onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2280%22><rect fill=%22%23334155%22 width=%2280%22 height=%2280%22/><text x=%2240%22 y=%2248%22 text-anchor=%22middle%22 fill=%22%2394a3b8%22 font-size=%2232%22>?</text></svg>'">
                <br>
                <label class="btn" style="margin-top:8px;display:inline-block;font-size:11px;padding:4px 12px;cursor:pointer">
                    Сменить аватар
                    <input type="file" id="av-upload" accept="image/*" style="display:none" onchange="uploadAvatar(this)">
                </label>
            </div>
            <div class="prof-info" style="flex:1">
                <p><b>Логин:</b> <span id="prof-user" style="color:var(--text)"></span></p>
                <p><b>Ник:</b> <span id="prof-nick" style="color:var(--text)"></span></p>
                <p><b>Роль:</b> <span id="prof-role"></span></p>
                <p><b>Статус:</b> <span id="prof-status" style="color:var(--text)"></span></p>
                <hr style="margin:12px 0;border-color:var(--border)">
                <div class="card alone">
                    <h2>Сменить ник</h2>
                    <div class="row"><label>Новый ник:</label><input type="text" id="new-nick" maxlength="20"><button class="btn btn-green" onclick="changeNick()">Сменить</button></div>
                </div>
                <div class="card alone">
                    <h2>Сменить пароль</h2>
                    <div class="row"><label>Старый пароль:</label><input type="password" id="old-pw"></div>
                    <div class="row"><label>Новый пароль:</label><input type="password" id="new-pw"></div>
                    <div class="row"><label></label><button class="btn btn-green" onclick="changePw()">Сменить</button></div>
                </div>
                <div class="danger">
                    <h2 style="font-size:13px;color:#f87171;border-color:#7f1d1d;padding-bottom:6px;margin-bottom:10px">Опасная зона</h2>
                    <p style="font-size:12px;color:var(--text2);margin-bottom:10px">Удаление аккаунта необратимо. Все посты и данные исчезнут навсегда.</p>
                    <button class="btn btn-red" onclick="confirmDelSelf()">Удалить мой аккаунт</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ЧУЖОЙ ПРОФИЛЬ -->
    <div id="page-userprofile" style="display:none">
        <div class="sec-hdr">Профиль игрока</div>
        <div class="prof-card">
            <div style="text-align:center"><img id="up-av" class="av-lg" src=""></div>
            <div class="prof-info">
                <p><b>Логин:</b> <span id="up-user" style="color:var(--text)"></span></p>
                <p><b>Ник:</b> <span id="up-nick" style="color:var(--text)"></span></p>
                <p><b>Роль:</b> <span id="up-role"></span></p>
                <p><b>На форуме с:</b> <span id="up-reg" style="color:var(--text)"></span></p>
            </div>
        </div>
    </div>

    <!-- ПОИСК -->
    <div id="page-search" style="display:none">
        <div class="sec-hdr">Поиск игрока</div>
        <div class="card">
            <h2>Найти игрока</h2>
            <div class="row">
                <label>Логин / Ник:</label>
                <input type="text" id="search-q" maxlength="30" placeholder="Введи имя..." onkeydown="if(event.key==='Enter')doSearch()">
                <button class="btn btn-green" onclick="doSearch()">Найти</button>
            </div>
        </div>
        <div id="search-res"></div>
    </div>

    <!-- НАСТРОЙКИ -->
    <div id="page-settings" style="display:none">
        <div class="sec-hdr">Настройки</div>
        <div class="card">
            <h2>Тема оформления</h2>
            <p style="font-size:12px;color:var(--text2);margin-bottom:12px">Каждая тема воссоздаёт эстетику форумов своего времени.</p>
            <div class="theme-grid">
                <div class="tc tc-2016" id="tc-2016" onclick="applyTheme('2016')">
                    <span class="yr">2016</span>
                    <span class="ds">Классика / Пиксель</span>
                </div>
                <div class="tc tc-2019" id="tc-2019" onclick="applyTheme('2019')">
                    <span class="yr">2019</span>
                    <span class="ds">Тёмный / Бирюзовый</span>
                </div>
                <div class="tc tc-2023 on" id="tc-2023" onclick="applyTheme('2023')">
                    <span class="yr">2023</span>
                    <span class="ds">Тёмный / Зелёный</span>
                </div>
                <div class="tc tc-2025" id="tc-2025" onclick="applyTheme('2025')">
                    <span class="yr">2025</span>
                    <span class="ds">Минимал / Фиолетовый</span>
                </div>
            </div>
        </div>
    </div>

    <!-- АДМИН-ПАНЕЛЬ -->
    <div id="page-admin" style="display:none">
        <div class="sec-hdr">Админ-панель — Управление пользователями</div>
        <div class="card">
            <h2>Роли / Бан / Мут / Удаление</h2>
            <p style="font-size:11px;color:var(--text2);margin-bottom:10px">
                <span class="rb rb-player">Игрок</span>
                <span class="rb rb-vip">ВИП</span>
                <span class="rb rb-moder">Модер</span>
                <span class="rb rb-admin">Админ</span>
                <span class="rb rb-coowner">Мл.Овнер</span>
                <span class="rb rb-owner">Owner</span>
            </p>
            <div class="row" style="margin-bottom:10px">
                <label>Фильтр:</label>
                <input type="text" id="adm-search" placeholder="Поиск по логину / нику..." style="width:220px" oninput="filterAdm()">
            </div>
            <div id="adm-list">Загрузка...</div>
        </div>
    </div>
</div>

<div class="lbx" id="lbx" onclick="this.classList.remove('on')">
    <img id="lbx-img" src="">
</div>

<div class="modal" id="modal-del">
    <div class="modal-box">
        <h3>Удалить аккаунт?</h3>
        <p id="modal-txt">Это действие необратимо.</p>
        <div class="modal-btns">
            <button class="btn btn-red" id="modal-confirm">Удалить</button>
            <button class="btn" onclick="closeModal()">Отмена</button>
        </div>
    </div>
</div>

<div class="footer">
    Powered by <span>MCWorld Forum Engine</span> v3.0 &copy; 2026 | Хостинг: render.com
</div>

<script>
    let CU = null, CR = null;
    const DEFAV = "data:image/svg+xml," + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80"><rect fill="#334155" width="80" height="80"/><text x="40" y="48" text-anchor="middle" fill="#94a3b8" font-size="32">?</text></svg>');
    const OWNERS = ["Admin","k1prs"];

    // ===== THEME =====
    function applyTheme(y) {
        document.body.className = y === "2023" ? "" : "t"+y;
        localStorage.setItem("mcw-theme", y);
        ["2016","2019","2023","2025"].forEach(t => {
            const el = document.getElementById("tc-"+t);
            if (el) el.classList.toggle("on", t === y);
        });
    }
    function loadTheme() { applyTheme(localStorage.getItem("mcw-theme") || "2023"); }

    // ===== API =====
    async function api(m, u, b) {
        const o = {method:m, headers:{}};
        if (b) { o.headers["Content-Type"]="application/json"; o.body=JSON.stringify(b); }
        return await (await fetch(u, o)).json();
    }

    function msg(txt, type) {
        const el = document.getElementById("status");
        el.textContent = txt;
        el.className = "status show " + (type||"");
        setTimeout(() => el.className = "status", 4000);
    }

    function switchTab(t) {
        document.getElementById("tab-login").className = t==="login" ? "tab on" : "tab";
        document.getElementById("tab-reg").className = t==="reg" ? "tab on" : "tab";
        document.getElementById("panel-login").className = t==="login" ? "panel on" : "panel";
        document.getElementById("panel-reg").className = t==="reg" ? "panel on" : "panel";
    }

    function go(page) {
        ["home","auth","forum","profile","admin","userprofile","search","settings"].forEach(p => {
            document.getElementById("page-"+p).style.display = p===page ? "" : "none";
        });
        if (page==="forum") loadPosts();
        if (page==="admin") loadAdm();
        if (page==="profile") loadProfile();
        if (page==="search") { document.getElementById("search-q").value=""; document.getElementById("search-res").innerHTML=""; }
    }

    async function viewProfile(un) {
        const d = await api("GET","/api/profile/"+encodeURIComponent(un));
        if (d.error) { msg(d.error,"err"); return; }
        document.getElementById("up-av").src = d.avatar||DEFAV;
        document.getElementById("up-user").textContent = d.username;
        document.getElementById("up-nick").textContent = d.nickname||d.username;
        document.getElementById("up-role").innerHTML = rb(d.role);
        document.getElementById("up-reg").textContent = new Date(d.registered*1000).toLocaleDateString("ru-RU");
        go("userprofile");
    }

    // ===== AUTH =====
    async function doLogin() {
        const u = document.getElementById("login-u").value.trim();
        const p = document.getElementById("login-p").value;
        if (!u||!p) { msg("Заполни все поля!","err"); return; }
        const d = await api("POST","/api/login",{username:u,password:p});
        if (d.error) { msg(d.error,"err"); return; }
        const role = OWNERS.includes(d.username) ? "owner" : d.role;
        setIn(d.username, role);
        msg("Добро пожаловать, "+d.username+"!","ok");
    }

    async function doRegister() {
        const u = document.getElementById("reg-u").value.trim();
        const p = document.getElementById("reg-p").value;
        const p2 = document.getElementById("reg-p2").value;
        if (!u||!p) { msg("Заполни все поля!","err"); return; }
        if (p!==p2) { msg("Пароли не совпадают!","err"); return; }
        const d = await api("POST","/api/register",{username:u,password:p});
        if (d.error) { msg(d.error,"err"); return; }
        const role = OWNERS.includes(d.username) ? "owner" : d.role;
        setIn(d.username, role);
        msg("Регистрация успешна!","ok");
    }

    async function doLogout() {
        await api("POST","/api/logout",{});
        CU=null; CR=null;
        ["nav-info","nav-logout","nav-admin","nav-profile","nav-forum","nav-search","nav-settings"].forEach(id => {
            document.getElementById(id).style.display="none";
        });
        go("auth");
        msg("Вы вышли из аккаунта","ok");
    }

    function setIn(username, role) {
        CU=username; CR=role;
        document.getElementById("nav-info").style.display="inline";
        document.getElementById("nav-info").innerHTML = esc(username)+" "+rb(role);
        document.getElementById("nav-logout").style.display="inline";
        document.getElementById("nav-forum").style.display="inline";
        document.getElementById("nav-search").style.display="inline";
        document.getElementById("nav-profile").style.display="inline";
        document.getElementById("nav-settings").style.display="inline";
        const staff = ["moder","admin","coowner","owner"].includes(role);
        document.getElementById("nav-admin").style.display = staff ? "inline" : "none";
        document.getElementById("new-post-form").style.display="";
        go("forum");
    }

    function rb(role) {
        const L = {player:"Игрок",vip:"ВИП",moder:"Модер",admin:"Админ",coowner:"Мл.Овнер",owner:"Owner"};
        return '<span class="rb rb-'+role+'">'+(L[role]||role)+'</span>';
    }

    function avImg(src, cls) {
        const s = src||DEFAV;
        return '<img class="'+(cls||"av-sm")+'" src="'+esc(s)+'" onerror="this.src=\''+DEFAV+'\'">';
    }

    // ===== POSTS =====
    async function loadPosts() {
        const d = await api("GET","/api/posts");
        const el = document.getElementById("posts-list");
        if (!d.posts||!d.posts.length) { el.innerHTML='<div class="empty">Тем пока нет. Будь первым!</div>'; return; }
        let h="";
        for (const p of d.posts) {
            const date = new Date(p.time*1000).toLocaleString("ru-RU");
            const canDel = ["admin","moder","owner","coowner"].includes(CR);
            h += '<div class="post">';
            h += '<div class="post-hdr"><div class="post-author">';
            h += avImg(p.avatar)+' ';
            h += '<a class="post-author-name" onclick="viewProfile(\''+esc(p.author)+'\')">'+esc(p.nickname||p.author)+'</a>';
            h += rb(p.role);
            h += ' &mdash; <span class="post-title">'+esc(p.title)+'</span>';
            h += '</div><div class="post-meta">'+date;
            if (canDel) h += '<button class="btn btn-red sm" onclick="delPost(\''+p.id+'\')">Удалить</button>';
            h += '</div></div>';
            h += '<div class="post-body">'+esc(p.content)+'</div>';
            if (p.media) {
                h += '<div class="post-media">';
                if (p.media_type==="image") h += '<img src="'+esc(p.media)+'" onclick="openLbx(\''+esc(p.media)+'\')">';
                else if (p.media_type==="video") h += '<video controls src="'+esc(p.media)+'"></video>';
                h += '</div>';
            }
            if (p.replies&&p.replies.length) {
                h += '<div class="replies">';
                for (const r of p.replies) {
                    const rd = new Date(r.time*1000).toLocaleString("ru-RU");
                    h += '<div class="reply">';
                    h += avImg(r.avatar)+' ';
                    h += '<a onclick="viewProfile(\''+esc(r.author)+'\')" style="font-weight:700;cursor:pointer">'+esc(r.nickname||r.author)+'</a> '+rb(r.role);
                    h += ' <span style="color:var(--text2);font-size:10px">'+rd+'</span><br>';
                    h += esc(r.content)+'</div>';
                }
                h += '</div>';
            }
            if (CU) {
                h += '<div class="reply-form"><input type="text" id="ri-'+p.id+'" placeholder="Написать ответ..." onkeydown="if(event.key===\'Enter\')doReply(\''+p.id+'\')"><button class="btn btn-green sm" onclick="doReply(\''+p.id+'\')">Ответить</button></div>';
            }
            h += '</div>';
        }
        el.innerHTML = h;
    }

    async function doPost() {
        const t = document.getElementById("post-title").value.trim();
        const c = document.getElementById("post-content").value.trim();
        if (!t||!c) { msg("Заполни заголовок и сообщение!","err"); return; }
        let media="", media_name="";
        const fi = document.getElementById("post-media");
        if (fi.files.length) {
            const f = fi.files[0];
            if (f.size>10*1024*1024) { msg("Файл слишком большой (макс 10МБ)!","err"); return; }
            media = await toB64(f); media_name = f.name;
        }
        const d = await api("POST","/api/posts",{title:t,content:c,media,media_name});
        if (d.error) { msg(d.error,"err"); return; }
        document.getElementById("post-title").value="";
        document.getElementById("post-content").value="";
        fi.value="";
        msg("Тема создана!","ok");
        loadPosts();
    }

    async function doReply(id) {
        const inp = document.getElementById("ri-"+id);
        const c = inp.value.trim();
        if (!c) return;
        const d = await api("POST","/api/reply",{post_id:id,content:c});
        if (d.error) { msg(d.error,"err"); return; }
        inp.value="";
        loadPosts();
    }

    async function delPost(id) {
        if (!confirm("Удалить тему?")) return;
        await api("POST","/api/admin/delete_post",{post_id:id});
        msg("Тема удалена","ok");
        loadPosts();
    }

    // ===== PROFILE =====
    async function loadProfile() {
        const d = await api("GET","/api/me");
        if (!d.username) { go("auth"); return; }
        document.getElementById("prof-user").textContent = d.username;
        document.getElementById("prof-nick").textContent = d.nickname||d.username;
        document.getElementById("prof-role").innerHTML = rb(OWNERS.includes(d.username)?"owner":d.role);
        document.getElementById("prof-av").src = d.avatar||DEFAV;
        document.getElementById("new-nick").value = d.nickname||d.username;
        let st="Активен";
        const now = Date.now()/1000;
        if (d.ban_until>now) st="ЗАБАНЕН (осталось "+Math.ceil((d.ban_until-now)/60)+" мин)";
        if (d.mute_until>now) st+=" | ЗАМЬЮЧЕН (осталось "+Math.ceil((d.mute_until-now)/60)+" мин)";
        document.getElementById("prof-status").textContent = st;
    }

    async function uploadAvatar(inp) {
        if (!inp.files.length) return;
        const f = inp.files[0];
        if (f.size>2*1024*1024) { msg("Аватарка слишком большая (макс 2МБ)!","err"); return; }
        const d = await api("POST","/api/profile/avatar",{avatar:await toB64(f)});
        if (d.error) { msg(d.error,"err"); return; }
        msg("Аватарка обновлена!","ok"); loadProfile();
    }

    async function changeNick() {
        const n = document.getElementById("new-nick").value.trim();
        if (!n) { msg("Введи ник!","err"); return; }
        const d = await api("POST","/api/profile/nickname",{nickname:n});
        if (d.error) { msg(d.error,"err"); return; }
        msg("Ник изменён!","ok"); loadProfile();
        document.getElementById("nav-info").innerHTML = esc(CU)+" "+rb(CR);
    }

    async function changePw() {
        const o = document.getElementById("old-pw").value;
        const n = document.getElementById("new-pw").value;
        if (!o||!n) { msg("Заполни оба поля!","err"); return; }
        const d = await api("POST","/api/profile/password",{old_password:o,new_password:n});
        if (d.error) { msg(d.error,"err"); return; }
        msg("Пароль изменён!","ok");
        document.getElementById("old-pw").value="";
        document.getElementById("new-pw").value="";
    }

    // ===== ADMIN =====
    let ADM_ALL = [];

    function filterAdm() {
        const q = (document.getElementById("adm-search").value||"").trim().toLowerCase();
        renderAdm(q ? ADM_ALL.filter(u=>u.username.toLowerCase().includes(q)||(u.nickname||"").toLowerCase().includes(q)) : ADM_ALL);
    }

    function renderAdm(users) {
        const el = document.getElementById("adm-list");
        const now = Date.now()/1000;
        if (!users.length) { el.innerHTML='<div class="empty">Никого не найдено</div>'; return; }
        let h="";
        for (const u of users) {
            const banned = u.ban_until>now, muted = u.mute_until>now;
            const su = esc(u.username);
            h += '<div class="adm-row">';
            h += avImg(u.avatar)+' <b>'+su+'</b> ';
            if (u.nickname&&u.nickname!==u.username) h += '<span style="color:var(--text2)">('+esc(u.nickname)+')</span> ';
            h += rb(u.role)+' ';
            if (banned) h += '<span class="bs bs-ban">ЗАБАНЕН</span> ';
            if (muted)  h += '<span class="bs bs-mute">ЗАМЬЮЧЕН</span> ';

            // coowner и owner могут менять роли до своего уровня
            const canRole = ["owner","coowner","admin"].includes(CR);
            if (canRole) {
                h += '<select id="rs-'+su+'">';
                h += '<option value="player"'+(u.role==="player"?" selected":"")+'>Игрок</option>';
                h += '<option value="vip"'+(u.role==="vip"?" selected":"")+'>ВИП</option>';
                h += '<option value="moder"'+(u.role==="moder"?" selected":"")+'>Модер</option>';
                h += '<option value="admin"'+(u.role==="admin"?" selected":"")+'>Админ</option>';
                if (CR==="owner") {
                    h += '<option value="coowner"'+(u.role==="coowner"?" selected":"")+'>Мл.Овнер</option>';
                    h += '<option value="owner"'+(u.role==="owner"?" selected":"")+'>Owner</option>';
                }
                h += '</select>';
                h += '<button class="btn sm" onclick="setRole(\''+su+'\')">Роль</button> ';
            }

            h += '<select id="ds-'+su+'">';
            h += '<option value="1800">30 мин</option>';
            h += '<option value="3600">1 час</option>';
            h += '<option value="7200">2 часа</option>';
            h += '<option value="43200">12 часов</option>';
            h += '<option value="86400">1 день</option>';
            if (["admin","owner","coowner"].includes(CR)) {
                h += '<option value="604800">7 дней</option>';
                h += '<option value="2592000">30 дней</option>';
                h += '<option value="99999999">Навсегда</option>';
            }
            h += '</select>';

            if (!banned) h += '<button class="btn btn-red sm" onclick="doBan(\''+su+'\')">Бан</button>';
            else         h += '<button class="btn btn-teal sm" onclick="doUnban(\''+su+'\')">Разбан</button>';
            if (!muted) h += '<button class="btn btn-yellow sm" onclick="doMute(\''+su+'\')">Мут</button>';
            else        h += '<button class="btn btn-teal sm" onclick="doUnmute(\''+su+'\')">Размут</button>';

            if (["owner","coowner"].includes(CR) && su!==esc(CU)) {
                h += '<button class="btn btn-red sm" onclick="confirmDelUser(\''+su+'\')">Удалить</button>';
            }
            h += '</div>';
        }
        el.innerHTML = h;
    }

    async function loadAdm() {
        const d = await api("GET","/api/users");
        if (d.error) {
            document.getElementById("adm-list").innerHTML='<div class="empty" style="color:var(--red)">Ошибка: '+esc(d.error)+'</div>';
            return;
        }
        ADM_ALL = d.users||[];
        filterAdm();
    }

    async function setRole(un) {
        const role = document.getElementById("rs-"+un).value;
        const d = await api("POST","/api/admin/role",{username:un,role});
        if (d.error) { msg(d.error,"err"); return; }
        msg("Роль "+un+" изменена!","ok"); loadAdm();
    }

    async function doBan(un) {
        const dur = document.getElementById("ds-"+un).value;
        const d = await api("POST","/api/admin/ban",{username:un,duration:parseInt(dur)});
        if (d.error) { msg(d.error,"err"); return; }
        msg(un+" забанен!","ok"); loadAdm();
    }
    async function doUnban(un) { await api("POST","/api/admin/unban",{username:un}); msg(un+" разбанен!","ok"); loadAdm(); }
    async function doMute(un) {
        const dur = document.getElementById("ds-"+un).value;
        const d = await api("POST","/api/admin/mute",{username:un,duration:parseInt(dur)});
        if (d.error) { msg(d.error,"err"); return; }
        msg(un+" замьючен!","ok"); loadAdm();
    }
    async function doUnmute(un) { await api("POST","/api/admin/unmute",{username:un}); msg(un+" размьючен!","ok"); loadAdm(); }

    // ===== DELETE =====
    let _dt=null, _ds=false;

    function confirmDelSelf() {
        _ds=true; _dt=CU;
        document.getElementById("modal-txt").textContent="Удалить аккаунт «"+CU+"»? Все посты и данные исчезнут навсегда.";
        document.getElementById("modal-confirm").onclick = execDel;
        document.getElementById("modal-del").classList.add("on");
    }
    function confirmDelUser(un) {
        _ds=false; _dt=un;
        document.getElementById("modal-txt").textContent="Удалить аккаунт «"+un+"»? Данные будут удалены навсегда.";
        document.getElementById("modal-confirm").onclick = execDel;
        document.getElementById("modal-del").classList.add("on");
    }
    function closeModal() { document.getElementById("modal-del").classList.remove("on"); _dt=null; }
    async function execDel() {
        closeModal();
        if (!_dt) return;
        const d = await api("POST","/api/admin/delete_user",{username:_dt});
        if (d.error) { msg(d.error,"err"); return; }
        if (_ds) { msg("Аккаунт удалён.","ok"); await doLogout(); }
        else { msg("Аккаунт "+_dt+" удалён!","ok"); loadAdm(); }
    }

    // ===== SEARCH =====
    async function doSearch() {
        const q = document.getElementById("search-q").value.trim();
        if (!q) { msg("Введи имя для поиска!","err"); return; }
        const d = await api("GET","/api/users");
        if (d.error) { msg(d.error,"err"); return; }
        const res = (d.users||[]).filter(u=>u.username.toLowerCase().includes(q.toLowerCase())||(u.nickname||"").toLowerCase().includes(q.toLowerCase()));
        const cont = document.getElementById("search-res");
        if (!res.length) { cont.innerHTML='<div class="card alone"><p style="text-align:center;color:var(--text2)">Игрок не найден</p></div>'; return; }
        let h = '<div class="sec-hdr alone" style="margin-top:8px">Результаты поиска ('+res.length+')</div>';
        for (const u of res) {
            const bn = u.ban_until>Date.now()/1000;
            h += '<div class="adm-row" style="background:var(--card);padding:8px 12px;border:1px solid var(--border);border-radius:var(--radius);margin:4px 0">';
            h += avImg(u.avatar)+' ';
            h += '<a onclick="viewProfile(\''+esc(u.username)+'\')" style="font-weight:700;cursor:pointer">'+esc(u.username)+'</a> ';
            if (u.nickname&&u.nickname!==u.username) h += '<span style="color:var(--text2)">('+esc(u.nickname)+')</span> ';
            h += rb(u.role);
            if (bn) h += ' <span class="bs bs-ban">ЗАБАНЕН</span>';
            h += '</div>';
        }
        cont.innerHTML = h;
    }

    // ===== UTILS =====
    function esc(s) { if (!s) return ""; const d=document.createElement("div"); d.textContent=s; return d.innerHTML; }
    function toB64(f) { return new Promise(r=>{ const rd=new FileReader(); rd.onload=()=>r(rd.result); rd.readAsDataURL(f); }); }
    function openLbx(s) { document.getElementById("lbx-img").src=s; document.getElementById("lbx").classList.add("on"); }

    // ===== INIT =====
    async function init() {
        loadTheme();
        const d = await api("GET","/api/me");
        if (d.username) {
            setIn(d.username, OWNERS.includes(d.username)?"owner":d.role);
        } else {
            go("auth");
        }
    }
    init();
    setInterval(()=>{ if(document.getElementById("page-forum").style.display!=="none") loadPosts(); }, 10000);
</script>
</body>
</html>
