<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCWorld Forum</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --green: #22c55e;
            --green-dark: #16a34a;
            --green-light: #dcfce7;
            --bg: #0f172a;
            --bg2: #1e293b;
            --bg3: #334155;
            --card: #1e293b;
            --border: #334155;
            --text: #f1f5f9;
            --text2: #94a3b8;
            --red: #ef4444;
            --yellow: #f59e0b;
            --purple: #a855f7;
            --gold: #fbbf24;
        }

        body {
            background: var(--bg);
            font-family: 'Nunito', sans-serif;
            font-size: 13px;
            color: var(--text);
            min-height: 100vh;
        }

        a { color: var(--green); text-decoration: none; cursor: pointer; }
        a:hover { text-decoration: underline; }

        /* HEADER */
        .forum-header {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a1e 50%, #0f172a 100%);
            border-bottom: 2px solid var(--green);
            padding: 16px 0 12px;
            text-align: center;
        }
        .forum-header h1 {
            font-family: 'Nunito', sans-serif;
            font-size: 32px;
            font-weight: 800;
            color: #fff;
            letter-spacing: 2px;
        }
        .forum-header h1 span { color: var(--green); }
        .forum-header .subtitle {
            font-size: 11px;
            color: var(--text2);
            margin-top: 4px;
            font-family: 'JetBrains Mono', monospace;
            letter-spacing: 3px;
        }

        /* NAVBAR */
        .navbar {
            background: var(--bg2);
            border-bottom: 1px solid var(--border);
            padding: 0 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .nav-links a {
            padding: 10px 14px;
            color: var(--text2) !important;
            display: inline-block;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.15s;
        }
        .nav-links a:hover {
            color: var(--green) !important;
            text-decoration: none;
            background: rgba(34,197,94,0.08);
        }
        .navbar .user-info { color: var(--green); font-weight: 700; font-size: 12px; }
        .navbar a:hover { color: var(--green); text-decoration: none; }
        #nav-logout { color: var(--red) !important; font-size: 12px; padding: 8px 0 8px 12px; }

        .wrapper { max-width: 900px; margin: 16px auto; padding: 0 12px; }

        /* SECTION HEADER */
        .section-header {
            background: linear-gradient(90deg, var(--green-dark), #15803d);
            color: #fff;
            padding: 8px 14px;
            font-weight: 800;
            font-size: 13px;
            border-radius: 8px 8px 0 0;
            margin-top: 12px;
            letter-spacing: 0.5px;
        }

        /* CARDS / FORMS */
        .form-box {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 0 0 8px 8px;
            padding: 16px;
            margin: 0 0 12px 0;
        }
        .form-box.standalone {
            border-radius: 8px;
            margin: 12px 0;
        }
        .form-box h2 {
            font-size: 14px;
            color: var(--green);
            margin-bottom: 12px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 6px;
            font-weight: 800;
        }
        .form-row { margin: 8px 0; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .form-row label { font-weight: 700; font-size: 12px; color: var(--text2); min-width: 110px; }

        input[type="text"], input[type="password"], textarea, select {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 6px 10px;
            font-family: 'Nunito', sans-serif;
            font-size: 12px;
            color: var(--text);
            outline: none;
            transition: border 0.15s;
        }
        input[type="text"]:focus, input[type="password"]:focus, textarea:focus, select:focus {
            border-color: var(--green);
        }
        input[type="text"], input[type="password"] { width: 200px; }
        textarea { width: 100%; height: 80px; resize: vertical; }
        select { padding: 5px 8px; cursor: pointer; }
        input[type="file"] { color: var(--text2); font-size: 11px; }

        /* BUTTONS */
        .btn {
            font-family: 'Nunito', sans-serif;
            font-size: 12px;
            padding: 6px 16px;
            cursor: pointer;
            border-radius: 6px;
            border: none;
            font-weight: 700;
            transition: all 0.15s;
            background: var(--bg3);
            color: var(--text);
        }
        .btn:hover { filter: brightness(1.15); }
        .btn-primary { background: var(--green); color: #fff; }
        .btn-danger { background: var(--red); color: #fff; }
        .btn-warn { background: var(--yellow); color: #1a1a1a; }
        .btn-success { background: #16a34a; color: #fff; }
        .btn-purple { background: var(--purple); color: #fff; }

        /* ROLE BADGES */
        .role-badge {
            font-size: 10px;
            font-weight: 700;
            padding: 2px 7px;
            border-radius: 4px;
            display: inline-block;
            margin-left: 4px;
        }
        .role-player { color: #94a3b8; background: rgba(148,163,184,0.12); border: 1px solid #475569; }
        .role-vip { color: var(--gold); background: rgba(251,191,36,0.12); border: 1px solid #92400e; }
        .role-moder { color: #4ade80; background: rgba(74,222,128,0.12); border: 1px solid #166534; }
        .role-admin { color: #f87171; background: rgba(248,113,113,0.12); border: 1px solid #991b1b; }
        .role-coowner { color: #c084fc; background: rgba(192,132,252,0.12); border: 1px solid #7e22ce; }
        .role-owner {
            color: #1a0a00;
            background: linear-gradient(90deg, #fbbf24, #f59e0b, #fbbf24);
            border: 1px solid #b45309;
            text-shadow: none;
            box-shadow: 0 0 6px #fbbf2444;
        }

        /* POSTS */
        .post-item {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin: 8px 0;
            overflow: hidden;
        }
        .post-header {
            background: rgba(34,197,94,0.06);
            padding: 8px 12px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .post-header .post-title { font-weight: 800; font-size: 13px; color: var(--green); }
        .post-header .post-meta { font-size: 10px; color: var(--text2); }
        .post-body { padding: 10px 12px; font-size: 12px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word; }
        .post-author { display: flex; gap: 8px; align-items: center; }
        .post-author-name { font-weight: 700; color: var(--text); }
        .post-media { padding: 6px 12px; }
        .post-media img { max-width: 400px; max-height: 300px; border-radius: 6px; border: 1px solid var(--border); cursor: pointer; }
        .post-media video { max-width: 400px; max-height: 300px; border-radius: 6px; border: 1px solid var(--border); }

        .avatar-small { width: 26px; height: 26px; border-radius: 4px; border: 1px solid var(--border); object-fit: cover; vertical-align: middle; }
        .avatar-big { width: 80px; height: 80px; border-radius: 8px; border: 2px solid var(--border); object-fit: cover; }

        /* REPLIES */
        .replies { border-top: 1px solid var(--border); }
        .reply-item {
            padding: 6px 12px 6px 28px;
            border-bottom: 1px solid rgba(51,65,85,0.5);
            background: rgba(15,23,42,0.5);
            font-size: 12px;
        }
        .reply-item:last-child { border-bottom: none; }
        .reply-form { padding: 6px 12px; background: rgba(15,23,42,0.4); display: flex; gap: 6px; }
        .reply-form input { flex: 1; }

        /* ADMIN */
        .admin-row {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 7px 0;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }
        .admin-row:last-child { border-bottom: none; }
        .ban-status { font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 700; }
        .ban-active { background: rgba(239,68,68,0.2); color: #f87171; border: 1px solid #991b1b; }
        .mute-active { background: rgba(245,158,11,0.2); color: #fbbf24; border: 1px solid #92400e; }

        /* TABS */
        .tabs { display: flex; gap: 4px; margin-top: 12px; }
        .tab {
            background: var(--bg2);
            border: 1px solid var(--border);
            border-bottom: none;
            border-radius: 6px 6px 0 0;
            padding: 7px 18px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            color: var(--text2);
            font-family: 'Nunito', sans-serif;
            transition: all 0.15s;
        }
        .tab:hover { color: var(--green); background: rgba(34,197,94,0.08); }
        .tab.active { background: var(--card); color: var(--green); border-color: var(--border); }
        .panel { display: none; }
        .panel.active { display: block; }

        /* FOOTER */
        .forum-footer {
            background: var(--bg2);
            color: var(--text2);
            text-align: center;
            padding: 10px;
            font-size: 11px;
            border-top: 1px solid var(--border);
            margin-top: 20px;
        }
        .forum-footer span { color: var(--green); }

        /* STATUS */
        .status-bar {
            padding: 8px 14px;
            font-size: 12px;
            margin: 8px 0;
            display: none;
            border-radius: 6px;
            font-weight: 700;
        }
        .status-bar.error { background: rgba(239,68,68,0.15); color: #f87171; border: 1px solid #991b1b; }
        .status-bar.success { background: rgba(34,197,94,0.15); color: #4ade80; border: 1px solid #166534; }
        .status-bar.visible { display: block; }

        .online-count { font-size: 12px; color: var(--text2); text-align: center; padding: 12px; }

        /* PROFILE */
        .profile-card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 16px;
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }
        .profile-info { flex: 1; }
        .profile-info p { margin: 5px 0; font-size: 12px; color: var(--text2); }
        .profile-info p b { color: var(--text); }

        /* DANGER ZONE */
        .danger-zone {
            border: 1px solid #7f1d1d;
            background: rgba(239,68,68,0.05);
            border-radius: 8px;
            padding: 14px;
            margin: 8px 0;
        }
        .danger-zone h2 { color: #f87171 !important; border-color: #7f1d1d !important; }

        /* LIGHTBOX */
        .lightbox { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 999; align-items: center; justify-content: center; cursor: pointer; }
        .lightbox.active { display: flex; }
        .lightbox img { max-width: 90vw; max-height: 90vh; border-radius: 8px; border: 2px solid var(--border); }

        /* MODAL CONFIRM */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 998; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal-box { background: var(--bg2); border: 1px solid var(--border); border-radius: 10px; padding: 24px; max-width: 360px; width: 90%; text-align: center; }
        .modal-box h3 { font-size: 16px; margin-bottom: 10px; color: var(--red); }
        .modal-box p { font-size: 12px; color: var(--text2); margin-bottom: 16px; }
        .modal-buttons { display: flex; gap: 10px; justify-content: center; }
    </style>
</head>

<body>

    <div class="forum-header">
        <h1>MC<span>World</span></h1>
        <div class="subtitle">:: MINECRAFT COMMUNITY FORUM :: 2026 ::</div>
    </div>

    <div class="navbar">
        <div class="nav-links">
            <a onclick="showPage('home')">üè† –ì–ª–∞–≤–Ω–∞—è</a>
            <a onclick="showPage('forum')" id="nav-forum" style="display:none">üí¨ –§–æ—Ä—É–º</a>
            <a onclick="showPage('search')" id="nav-search" style="display:none">üîç –ü–æ–∏—Å–∫</a>
            <a onclick="showPage('profile')" id="nav-profile" style="display:none">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
            <a onclick="showPage('admin')" id="nav-admin" style="display:none">üõ°Ô∏è –ê–¥–º–∏–Ω</a>
        </div>
        <div style="padding: 0 8px; display:flex; align-items:center; gap:10px;">
            <span id="nav-user-info" class="user-info" style="display:none"></span>
            <a onclick="doLogout()" id="nav-logout" style="display:none;">[–í—ã—Ö–æ–¥]</a>
        </div>
    </div>

    <div class="wrapper">
        <div class="status-bar" id="status-bar"></div>

        <!-- ===== –ì–õ–ê–í–ù–ê–Ø ===== -->
        <div id="page-home">
            <div class="section-header">üè† –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ MCWorld Forum!</div>
            <div class="form-box">
                <h2>‚öîÔ∏è –ò—Å—Ç–æ—Ä–∏—è Minecraft</h2>
                <p style="font-size:12px;line-height:1.8;color:var(--text2);">
                    <b style="color:var(--text)">Minecraft</b> ‚Äî —ç—Ç–æ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è –ø–µ—Å–æ—á–Ω–∏—Ü–∞, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —à–≤–µ–¥—Å–∫–∏–º –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–æ–º <b style="color:var(--text)">–ú–∞—Ä–∫—É—Å–æ–º "Notch" –ü–µ—Ä—Å—Å–æ–Ω–æ–º</b> –≤ 2009 –≥–æ–¥—É.
                    –ü–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è (Cave Game) –ø–æ—è–≤–∏–ª–∞—Å—å 17 –º–∞—è 2009 –≥–æ–¥–∞. –ò–≥—Ä–∞ –±—ã—Å—Ç—Ä–æ —Å—Ç–∞–ª–∞ —Ö–∏—Ç–æ–º ‚Äî –º–∏–ª–ª–∏–æ–Ω—ã –ª—é–¥–µ–π –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É –Ω–∞—á–∞–ª–∏ —Å—Ç—Ä–æ–∏—Ç—å, –∫–æ–ø–∞—Ç—å –∏ –≤—ã–∂–∏–≤–∞—Ç—å –≤ –∫—É–±–∏—á–µ—Å–∫–æ–º –º–∏—Ä–µ.
                    <br><br>
                    –í 2011 –≥–æ–¥—É –≤—ã—à–ª–∞ –ø–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è 1.0. –í 2014 –≥–æ–¥—É Microsoft –∫—É–ø–∏–ª–∞ Mojang –∑–∞ <b style="color:var(--green)">2.5 –º–∏–ª–ª–∏–∞—Ä–¥–∞ –¥–æ–ª–ª–∞—Ä–æ–≤</b>.
                    –°–µ–π—á–∞—Å Minecraft ‚Äî —Å–∞–º–∞—è –ø—Ä–æ–¥–∞–≤–∞–µ–º–∞—è –∏–≥—Ä–∞ –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Å –±–æ–ª–µ–µ —á–µ–º <b style="color:var(--green)">300 –º–∏–ª–ª–∏–æ–Ω–∞–º–∏</b> –ø—Ä–æ–¥–∞–Ω–Ω—ã—Ö –∫–æ–ø–∏–π.
                    <br><br>
                    –ö—Ä–∏–ø–µ—Ä, –°—Ç–∏–≤, –≠–Ω–¥–µ—Ä–º–µ–Ω, –∞–ª–º–∞–∑–Ω–∞—è –∫–∏—Ä–∫–∞ ‚Äî –≤—Å—ë —ç—Ç–æ —Å—Ç–∞–ª–æ —á–∞—Å—Ç—å—é –º–∏—Ä–æ–≤–æ–π –∫—É–ª—å—Ç—É—Ä—ã. Minecraft ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏–≥—Ä–∞, —ç—Ç–æ —Ü–µ–ª–∞—è –≤—Å–µ–ª–µ–Ω–Ω–∞—è!
                </p>
            </div>
            <div class="form-box standalone">
                <h2>üìñ –ò—Å—Ç–æ—Ä–∏—è —ç—Ç–æ–≥–æ —Å–∞–π—Ç–∞</h2>
                <p style="font-size:12px;line-height:1.8;color:var(--text2);">
                    –≠—Ç–æ—Ç —Ñ–æ—Ä—É–º –±—ã–ª —Å–æ–∑–¥–∞–Ω <b style="color:var(--text)">20 —Ñ–µ–≤—Ä–∞–ª—è 2026 –≥–æ–¥–∞</b> –ø—Ä–∏–º–µ—Ä–Ω–æ –≤ <b style="color:var(--text)">22:00</b>.
                    <br><br>
                    –ö–∞–∫ —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ? –í—Å—ë –ø—Ä–æ—Å—Ç–æ ‚Äî –∞–≤—Ç–æ—Ä—É –±—ã–ª–æ <b style="color:var(--text)">—Å–∫—É—á–Ω–æ</b> –æ–¥–Ω–∏–º –≤–µ—á–µ—Ä–æ–º,
                    –∏ –æ–Ω —Ä–µ—à–∏–ª –≤–∑—è—Ç—å –∏ —Å–¥–µ–ª–∞—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π Minecraft-—Ñ–æ—Ä—É–º.
                    –ë—É–∫–≤–∞–ª—å–Ω–æ –Ω–∞ —Å–∫–æ—Ä—É—é —Ä—É–∫—É, –∑–∞ –æ–¥–∏–Ω –≤–µ—á–µ—Ä, —Ä–æ–¥–∏–ª—Å—è —ç—Ç–æ—Ç —Å–∞–π—Ç.
                    <br><br>
                    –°–Ω–∞—á–∞–ª–∞ —ç—Ç–æ –±—ã–ª –ø—Ä–æ—Å—Ç–æ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç, –Ω–æ –ø–æ—Ç–æ–º –ø–æ—è–≤–∏–ª–∏—Å—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø–æ—Å—Ç—ã, –∞–≤–∞—Ç–∞—Ä–∫–∏,
                    —Ä–æ–ª–∏, –±–∞–Ω-—Å–∏—Å—Ç–µ–º–∞ –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ. –ò –≤–æ—Ç –æ–Ω ‚Äî <b style="color:var(--green)">MCWorld Forum</b>, –∂–∏–≤–æ–π –∏ —Ä–∞–±–æ—Ç–∞—é—â–∏–π!
                    <br><br>
                    <i style="color:var(--text2)">"–ö–æ–≥–¥–∞ —Å–∫—É—á–Ω–æ ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä—É–π. –¢–∞–∫ —Ä–æ–∂–¥–∞—é—Ç—Å—è –≤–µ–ª–∏–∫–∏–µ –≤–µ—â–∏."</i>
                </p>
            </div>
        </div>

        <!-- ===== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø ===== -->
        <div id="page-auth">
            <div class="tabs">
                <div class="tab active" id="tab-login" onclick="switchTab('login')">üîê –í—Ö–æ–¥</div>
                <div class="tab" id="tab-register" onclick="switchTab('register')">üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
            </div>
            <div class="panel active" id="panel-login">
                <div class="form-box">
                    <h2>üîê –í—Ö–æ–¥ –Ω–∞ —Ñ–æ—Ä—É–º</h2>
                    <div class="form-row">
                        <label>–õ–æ–≥–∏–Ω:</label>
                        <input type="text" id="login-username" maxlength="20">
                    </div>
                    <div class="form-row">
                        <label>–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="login-password" maxlength="50" onkeydown="if(event.key==='Enter')doLogin()">
                    </div>
                    <div class="form-row" style="margin-top:10px;">
                        <label></label>
                        <button class="btn btn-primary" onclick="doLogin()">–í–æ–π—Ç–∏</button>
                    </div>
                </div>
            </div>
            <div class="panel" id="panel-register">
                <div class="form-box">
                    <h2>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞</h2>
                    <div class="form-row">
                        <label>–õ–æ–≥–∏–Ω:</label>
                        <input type="text" id="reg-username" maxlength="20">
                    </div>
                    <div class="form-row">
                        <label>–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="reg-password" maxlength="50">
                    </div>
                    <div class="form-row">
                        <label>–ü–∞—Ä–æ–ª—å –µ—â—ë —Ä–∞–∑:</label>
                        <input type="password" id="reg-password2" maxlength="50" onkeydown="if(event.key==='Enter')doRegister()">
                    </div>
                    <div class="form-row" style="margin-top:10px;">
                        <label></label>
                        <button class="btn btn-primary" onclick="doRegister()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== –§–û–†–£–ú ===== -->
        <div id="page-forum" style="display:none">
            <div class="section-header">‚úèÔ∏è –ù–æ–≤–∞—è —Ç–µ–º–∞</div>
            <div class="form-box" id="new-post-form">
                <div class="form-row">
                    <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫:</label>
                    <input type="text" id="post-title" maxlength="100" style="width:calc(100% - 120px);">
                </div>
                <div class="form-row" style="align-items:flex-start;">
                    <label style="padding-top:6px;">–°–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <textarea id="post-content" style="flex:1;"></textarea>
                </div>
                <div class="form-row">
                    <label>–§–æ—Ç–æ / –í–∏–¥–µ–æ:</label>
                    <input type="file" id="post-media" accept="image/*,video/*">
                </div>
                <div class="form-row" style="margin-top:8px;">
                    <label></label>
                    <button class="btn btn-primary" onclick="doPost()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
            <div class="section-header">üí¨ –¢–µ–º—ã —Ñ–æ—Ä—É–º–∞</div>
            <div id="posts-list">
                <div class="online-count">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>

        <!-- ===== –ü–†–û–§–ò–õ–¨ ===== -->
        <div id="page-profile" style="display:none">
            <div class="section-header">üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</div>
            <div class="profile-card" style="margin-top:0; border-radius: 0 0 8px 8px;">
                <div style="text-align:center;">
                    <img id="profile-avatar-img" class="avatar-big" src="" alt="–ê–≤–∞—Ç–∞—Ä"
                        onerror="this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%2280%22 height=%2280%22><rect fill=%22%23334155%22 width=%2280%22 height=%2280%22/><text x=%2240%22 y=%2248%22 text-anchor=%22middle%22 fill=%22%2394a3b8%22 font-size=%2232%22>?</text></svg>'">
                    <br>
                    <label class="btn" style="margin-top:8px;display:inline-block;font-size:11px;padding:4px 12px;cursor:pointer;">
                        üì∑ –°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
                        <input type="file" id="avatar-upload" accept="image/*" style="display:none;" onchange="uploadAvatar(this)">
                    </label>
                </div>
                <div class="profile-info" style="flex:1;">
                    <p><b>–õ–æ–≥–∏–Ω:</b> <span id="profile-username" style="color:var(--text);"></span></p>
                    <p><b>–ù–∏–∫:</b> <span id="profile-nickname" style="color:var(--text);"></span></p>
                    <p><b>–†–æ–ª—å:</b> <span id="profile-role"></span></p>
                    <p><b>–°—Ç–∞—Ç—É—Å:</b> <span id="profile-status" style="color:var(--text);"></span></p>
                    <hr style="margin:12px 0; border-color:var(--border);">

                    <div class="form-box standalone">
                        <h2>‚úèÔ∏è –°–º–µ–Ω–∏—Ç—å –Ω–∏–∫</h2>
                        <div class="form-row">
                            <label>–ù–æ–≤—ã–π –Ω–∏–∫:</label>
                            <input type="text" id="new-nickname" maxlength="20">
                            <button class="btn btn-primary" onclick="changeNickname()">–°–º–µ–Ω–∏—Ç—å</button>
                        </div>
                    </div>

                    <div class="form-box standalone">
                        <h2>üîë –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</h2>
                        <div class="form-row">
                            <label>–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="old-password">
                        </div>
                        <div class="form-row">
                            <label>–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="new-password">
                        </div>
                        <div class="form-row">
                            <label></label>
                            <button class="btn btn-primary" onclick="changePassword()">–°–º–µ–Ω–∏—Ç—å</button>
                        </div>
                    </div>

                    <div class="danger-zone">
                        <h2 style="font-size:13px;color:#f87171;border-bottom:1px solid #7f1d1d;padding-bottom:6px;margin-bottom:10px;">‚ö†Ô∏è –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h2>
                        <p style="font-size:12px;color:var(--text2);margin-bottom:10px;">–£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ. –í—Å–µ —Ç–≤–æ–∏ –ø–æ—Å—Ç—ã –∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞.</p>
                        <button class="btn btn-danger" onclick="confirmDeleteSelf()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –º–æ–π –∞–∫–∫–∞—É–Ω—Ç</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ===== –ß–£–ñ–û–ô –ü–†–û–§–ò–õ–¨ ===== -->
        <div id="page-userprofile" style="display:none">
            <div class="section-header">üë§ –ü—Ä–æ—Ñ–∏–ª—å –∏–≥—Ä–æ–∫–∞</div>
            <div class="profile-card" style="border-radius:0 0 8px 8px;">
                <div style="text-align:center;">
                    <img id="up-avatar" class="avatar-big" src="">
                </div>
                <div class="profile-info">
                    <p><b>–õ–æ–≥–∏–Ω:</b> <span id="up-username" style="color:var(--text);"></span></p>
                    <p><b>–ù–∏–∫:</b> <span id="up-nickname" style="color:var(--text);"></span></p>
                    <p><b>–†–æ–ª—å:</b> <span id="up-role"></span></p>
                    <p><b>–ù–∞ —Ñ–æ—Ä—É–º–µ —Å:</b> <span id="up-registered" style="color:var(--text);"></span></p>
                </div>
            </div>
        </div>

        <!-- ===== –ü–û–ò–°–ö –ò–ì–†–û–ö–ê ===== -->
        <div id="page-search" style="display:none">
            <div class="section-header">üîç –ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–∞</div>
            <div class="form-box">
                <h2>üë§ –ù–∞–π—Ç–∏ –∏–≥—Ä–æ–∫–∞</h2>
                <div class="form-row">
                    <label>–õ–æ–≥–∏–Ω / –ù–∏–∫:</label>
                    <input type="text" id="search-query" maxlength="30" placeholder="–í–≤–µ–¥–∏ –∏–º—è..." onkeydown="if(event.key==='Enter')doSearch()">
                    <button class="btn btn-primary" onclick="doSearch()">–ù–∞–π—Ç–∏</button>
                </div>
            </div>
            <div id="search-results"></div>
        </div>

        <!-- ===== –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ ===== -->
        <div id="page-admin" style="display:none">
            <div class="section-header">üõ°Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</div>
            <div class="form-box">
                <h2>–†–æ–ª–∏ / –ë–∞–Ω / –ú—É—Ç / –£–¥–∞–ª–µ–Ω–∏–µ</h2>
                <p style="font-size:11px;color:var(--text2);margin-bottom:10px;">
                    –†–æ–ª–∏:
                    <span class="role-badge role-player">–ò–≥—Ä–æ–∫</span>
                    <span class="role-badge role-vip">–í–ò–ü</span>
                    <span class="role-badge role-moder">–ú–æ–¥–µ—Ä</span>
                    <span class="role-badge role-admin">–ê–¥–º–∏–Ω</span>
                    <span class="role-badge role-coowner">–ú–ª.–û–≤–Ω–µ—Ä</span>
                    <span class="role-badge role-owner">‚≠ê Owner</span>
                </p>
                <div class="form-row" style="margin-bottom:10px;">
                    <label>üîç –§–∏–ª—å—Ç—Ä:</label>
                    <input type="text" id="admin-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –ª–æ–≥–∏–Ω—É / –Ω–∏–∫—É..." style="width:220px;" oninput="filterAdminUsers()">
                </div>
                <div id="admin-users-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>
    </div>

    <!-- LIGHTBOX -->
    <div class="lightbox" id="lightbox" onclick="this.classList.remove('active')">
        <img id="lightbox-img" src="">
    </div>

    <!-- MODAL CONFIRM DELETE -->
    <div class="modal-overlay" id="modal-delete">
        <div class="modal-box">
            <h3>‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç?</h3>
            <p id="modal-delete-text">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ. –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞.</p>
            <div class="modal-buttons">
                <button class="btn btn-danger" id="modal-delete-confirm">–£–¥–∞–ª–∏—Ç—å</button>
                <button class="btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <div class="forum-footer">
        Powered by <span>MCWorld Forum Engine</span> v3.0 &copy; 2026 |
        –•–æ—Å—Ç–∏–Ω–≥: render.com | –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã
    </div>

    <script>
        let currentUser = null;
        let currentRole = null;
        const DEFAULT_AVATAR = "data:image/svg+xml," + encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="80" height="80"><rect fill="#888" width="80" height="80"/><text x="40" y="48" text-anchor="middle" fill="white" font-size="32">?</text></svg>');

        async function api(method, url, body) {
            const opts = { method, headers: {} };
            if (body) { opts.headers["Content-Type"] = "application/json"; opts.body = JSON.stringify(body); }
            const res = await fetch(url, opts);
            return await res.json();
        }

        function showStatus(msg, type) {
            const el = document.getElementById("status-bar");
            el.textContent = msg;
            el.className = "status-bar visible " + (type || "");
            setTimeout(() => { el.className = "status-bar"; }, 4000);
        }

        function switchTab(tab) {
            document.getElementById("tab-login").className = tab === "login" ? "tab active" : "tab";
            document.getElementById("tab-register").className = tab === "register" ? "tab active" : "tab";
            document.getElementById("panel-login").className = tab === "login" ? "panel active" : "panel";
            document.getElementById("panel-register").className = tab === "register" ? "panel active" : "panel";
        }

        function showPage(page) {
            ["home", "auth", "forum", "profile", "admin", "userprofile", "search"].forEach(p => {
                document.getElementById("page-" + p).style.display = p === page ? "" : "none";
            });
            if (page === "forum") loadPosts();
            if (page === "admin") loadAdminUsers();
            if (page === "profile") loadProfile();
            if (page === "search") { document.getElementById("search-query").value = ""; document.getElementById("search-results").innerHTML = ""; }
        }

        async function viewProfile(username) {
            const data = await api("GET", "/api/profile/" + encodeURIComponent(username));
            if (data.error) { showStatus(data.error, "error"); return; }
            document.getElementById("up-avatar").src = data.avatar || DEFAULT_AVATAR;
            document.getElementById("up-username").textContent = data.username;
            document.getElementById("up-nickname").textContent = data.nickname || data.username;
            document.getElementById("up-role").innerHTML = roleBadge(data.role);
            document.getElementById("up-registered").textContent = new Date(data.registered * 1000).toLocaleDateString("ru-RU");
            showPage("userprofile");
        }

        // ========== AUTH ==========
        async function doLogin() {
            const username = document.getElementById("login-username").value.trim();
            const password = document.getElementById("login-password").value;
            if (!username || !password) { showStatus("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!", "error"); return; }
            const data = await api("POST", "/api/login", { username, password });
            if (data.error) { showStatus(data.error, "error"); return; }
            // Auto-promote "Admin" account to owner
            let role = data.role;
            if (data.username === "Admin" && role !== "owner") {
                const r = await api("POST", "/api/admin/role", { username: "Admin", role: "owner" });
                if (!r.error) role = "owner";
            }
            setLoggedIn(data.username, role);
            showStatus("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, " + data.username + "!", "success");
        }

        async function doRegister() {
            const username = document.getElementById("reg-username").value.trim();
            const password = document.getElementById("reg-password").value;
            const password2 = document.getElementById("reg-password2").value;
            if (!username || !password) { showStatus("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ –ø–æ–ª—è!", "error"); return; }
            if (password !== password2) { showStatus("–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç!", "error"); return; }
            const data = await api("POST", "/api/register", { username, password });
            if (data.error) { showStatus(data.error, "error"); return; }
            setLoggedIn(data.username, data.role);
            showStatus("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!", "success");
        }

        async function doLogout() {
            await api("POST", "/api/logout", {});
            currentUser = null; currentRole = null;
            ["nav-user-info", "nav-logout", "nav-admin", "nav-profile", "nav-forum", "nav-search"].forEach(id => {
                document.getElementById(id).style.display = "none";
            });
            showPage("auth");
            showStatus("–í—ã –≤—ã—à–ª–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞", "success");
        }

        function setLoggedIn(username, role) {
            currentUser = username; currentRole = role;
            document.getElementById("nav-user-info").style.display = "inline";
            document.getElementById("nav-user-info").innerHTML = username + " " + roleBadge(role);
            document.getElementById("nav-logout").style.display = "inline";
            document.getElementById("nav-forum").style.display = "inline";
            document.getElementById("nav-search").style.display = "inline";
            document.getElementById("nav-profile").style.display = "inline";
            document.getElementById("nav-admin").style.display = (role === "admin" || role === "moder" || role === "owner" || role === "coowner") ? "inline" : "none";
            document.getElementById("new-post-form").style.display = "";
            showPage("forum");
        }

        function roleBadge(role) {
            const labels = { player: "–ò–≥—Ä–æ–∫", vip: "–í–ò–ü", moder: "–ú–æ–¥–µ—Ä", admin: "–ê–¥–º–∏–Ω", coowner: "–ú–ª.–û–≤–Ω–µ—Ä", owner: "‚≠ê Owner" };
            return '<span class="role-badge role-' + role + '">' + (labels[role] || role) + '</span>';
        }

        function avatarImg(src, cls) {
            const s = src || DEFAULT_AVATAR;
            return '<img class="' + (cls || "avatar-small") + '" src="' + esc(s) + '" onerror="this.src=\'' + DEFAULT_AVATAR + '\'">';
        }

        // ========== POSTS ==========
        async function loadPosts() {
            const data = await api("GET", "/api/posts");
            const list = document.getElementById("posts-list");
            if (!data.posts || data.posts.length === 0) {
                list.innerHTML = '<div class="online-count">–¢–µ–º –ø–æ–∫–∞ –Ω–µ—Ç. –ë—É–¥—å –ø–µ—Ä–≤—ã–º!</div>';
                return;
            }
            let html = "";
            for (const post of data.posts) {
                const date = new Date(post.time * 1000).toLocaleString("ru-RU");
                const canDelete = currentRole === "admin" || currentRole === "moder";
                html += '<div class="post-item">';
                html += '<div class="post-header"><div class="post-author">';
                html += avatarImg(post.avatar) + ' ';
                html += '<a class="post-author-name" onclick="viewProfile(\'' + esc(post.author) + '\')">' + esc(post.nickname || post.author) + '</a>';
                html += roleBadge(post.role);
                html += ' &mdash; <span class="post-title">' + esc(post.title) + '</span>';
                html += '</div><div class="post-meta">' + date;
                if (canDelete) {
                    html += ' <button class="btn btn-danger" style="font-size:9px;padding:1px 6px;margin-left:4px;" onclick="deletePost(\'' + post.id + '\')">X</button>';
                }
                html += '</div></div>';
                html += '<div class="post-body">' + esc(post.content) + '</div>';

                if (post.media) {
                    html += '<div class="post-media">';
                    if (post.media_type === "image") {
                        html += '<img src="' + esc(post.media) + '" onclick="openLightbox(\'' + esc(post.media) + '\')">';
                    } else if (post.media_type === "video") {
                        html += '<video controls src="' + esc(post.media) + '"></video>';
                    }
                    html += '</div>';
                }

                if (post.replies && post.replies.length > 0) {
                    html += '<div class="replies">';
                    for (const r of post.replies) {
                        const rdate = new Date(r.time * 1000).toLocaleString("ru-RU");
                        html += '<div class="reply-item">';
                        html += avatarImg(r.avatar) + ' ';
                        html += '<a onclick="viewProfile(\'' + esc(r.author) + '\')" style="font-weight:bold;cursor:pointer;">' + esc(r.nickname || r.author) + '</a> ' + roleBadge(r.role);
                        html += ' <span style="color:#888;font-size:9px;">' + rdate + '</span><br>';
                        html += esc(r.content) + '</div>';
                    }
                    html += '</div>';
                }

                if (currentUser) {
                    html += '<div class="reply-form">';
                    html += '<input type="text" id="reply-' + post.id + '" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç..." onkeydown="if(event.key===\'Enter\')doReply(\'' + post.id + '\')">';
                    html += '<button class="btn" onclick="doReply(\'' + post.id + '\')">–û—Ç–≤–µ—Ç–∏—Ç—å</button>';
                    html += '</div>';
                }
                html += '</div>';
            }
            list.innerHTML = html;
        }

        async function doPost() {
            const title = document.getElementById("post-title").value.trim();
            const content = document.getElementById("post-content").value.trim();
            if (!title || !content) { showStatus("–ó–∞–ø–æ–ª–Ω–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ!", "error"); return; }

            let media = "";
            let media_name = "";
            const fileInput = document.getElementById("post-media");
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                if (file.size > 10 * 1024 * 1024) { showStatus("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å 10–ú–ë)!", "error"); return; }
                media = await readFileAsBase64(file);
                media_name = file.name;
            }

            const data = await api("POST", "/api/posts", { title, content, media, media_name });
            if (data.error) { showStatus(data.error, "error"); return; }
            document.getElementById("post-title").value = "";
            document.getElementById("post-content").value = "";
            fileInput.value = "";
            showStatus("–¢–µ–º–∞ —Å–æ–∑–¥–∞–Ω–∞!", "success");
            loadPosts();
        }

        async function doReply(postId) {
            const input = document.getElementById("reply-" + postId);
            const content = input.value.trim();
            if (!content) return;
            const data = await api("POST", "/api/reply", { post_id: postId, content });
            if (data.error) { showStatus(data.error, "error"); return; }
            loadPosts();
        }

        async function deletePost(postId) {
            if (!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç–µ–º—É?")) return;
            await api("POST", "/api/admin/delete_post", { post_id: postId });
            showStatus("–¢–µ–º–∞ —É–¥–∞–ª–µ–Ω–∞", "success");
            loadPosts();
        }

        // ========== PROFILE ==========
        async function loadProfile() {
            const data = await api("GET", "/api/me");
            if (!data.username) { showPage("auth"); return; }
            document.getElementById("profile-username").textContent = data.username;
            document.getElementById("profile-nickname").textContent = data.nickname || data.username;
            document.getElementById("profile-role").innerHTML = roleBadge(data.role);
            document.getElementById("profile-avatar-img").src = data.avatar || DEFAULT_AVATAR;
            document.getElementById("new-nickname").value = data.nickname || data.username;

            let status = "–ê–∫—Ç–∏–≤–µ–Ω";
            if (data.ban_until > Date.now() / 1000) {
                const r = Math.ceil((data.ban_until - Date.now() / 1000) / 60);
                status = "–ó–ê–ë–ê–ù–ï–ù (–æ—Å—Ç–∞–ª–æ—Å—å " + r + " –º–∏–Ω)";
            }
            if (data.mute_until > Date.now() / 1000) {
                const r = Math.ceil((data.mute_until - Date.now() / 1000) / 60);
                status += " | –ó–ê–ú–¨–Æ–ß–ï–ù (–æ—Å—Ç–∞–ª–æ—Å—å " + r + " –º–∏–Ω)";
            }
            document.getElementById("profile-status").textContent = status;
        }

        async function uploadAvatar(input) {
            if (!input.files.length) return;
            const file = input.files[0];
            if (file.size > 2 * 1024 * 1024) { showStatus("–ê–≤–∞—Ç–∞—Ä–∫–∞ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è (–º–∞–∫—Å 2–ú–ë)!", "error"); return; }
            const b64 = await readFileAsBase64(file);
            const data = await api("POST", "/api/profile/avatar", { avatar: b64 });
            if (data.error) { showStatus(data.error, "error"); return; }
            showStatus("–ê–≤–∞—Ç–∞—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!", "success");
            loadProfile();
        }

        async function changeNickname() {
            const nick = document.getElementById("new-nickname").value.trim();
            if (!nick) { showStatus("–í–≤–µ–¥–∏ –Ω–∏–∫!", "error"); return; }
            const data = await api("POST", "/api/profile/nickname", { nickname: nick });
            if (data.error) { showStatus(data.error, "error"); return; }
            showStatus("–ù–∏–∫ –∏–∑–º–µ–Ω—ë–Ω!", "success");
            loadProfile();
            document.getElementById("nav-user-info").innerHTML = currentUser + " " + roleBadge(currentRole);
        }

        async function changePassword() {
            const oldPw = document.getElementById("old-password").value;
            const newPw = document.getElementById("new-password").value;
            if (!oldPw || !newPw) { showStatus("–ó–∞–ø–æ–ª–Ω–∏ –æ–±–∞ –ø–æ–ª—è!", "error"); return; }
            const data = await api("POST", "/api/profile/password", { old_password: oldPw, new_password: newPw });
            if (data.error) { showStatus(data.error, "error"); return; }
            showStatus("–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω—ë–Ω!", "success");
            document.getElementById("old-password").value = "";
            document.getElementById("new-password").value = "";
        }

        // ========== ADMIN ==========
        let allAdminUsers = [];

        function filterAdminUsers() {
            const q = (document.getElementById("admin-search").value || "").trim().toLowerCase();
            renderAdminUsers(q ? allAdminUsers.filter(u =>
                u.username.toLowerCase().includes(q) ||
                (u.nickname || "").toLowerCase().includes(q)
            ) : allAdminUsers);
        }

        function renderAdminUsers(users) {
            const list = document.getElementById("admin-users-list");
            const now = Date.now() / 1000;
            if (!users.length) { list.innerHTML = '<div class="online-count">–ù–∏–∫–æ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>'; return; }
            let html = "";
            for (const u of users) {
                const isBanned = u.ban_until > now;
                const isMuted = u.mute_until > now;
                const safeUN = esc(u.username);
                html += '<div class="admin-row">';
                html += avatarImg(u.avatar) + ' ';
                html += '<b>' + safeUN + '</b> ';
                if (u.nickname && u.nickname !== u.username) html += '(' + esc(u.nickname) + ') ';
                html += roleBadge(u.role) + ' ';
                if (isBanned) html += '<span class="ban-status ban-active">–ó–ê–ë–ê–ù–ï–ù</span> ';
                if (isMuted) html += '<span class="ban-status mute-active">–ó–ê–ú–¨–Æ–ß–ï–ù</span> ';

                // Role selector ‚Äî owner can set coowner; admin can set up to admin; moder no role change
                const canSetRole = currentRole === "owner" || currentRole === "admin";
                if (canSetRole) {
                    html += '<select id="role-sel-' + safeUN + '">';
                    html += '<option value="player"' + (u.role === "player" ? " selected" : "") + '>–ò–≥—Ä–æ–∫</option>';
                    html += '<option value="vip"' + (u.role === "vip" ? " selected" : "") + '>–í–ò–ü</option>';
                    html += '<option value="moder"' + (u.role === "moder" ? " selected" : "") + '>–ú–æ–¥–µ—Ä</option>';
                    html += '<option value="admin"' + (u.role === "admin" ? " selected" : "") + '>–ê–¥–º–∏–Ω</option>';
                    if (currentRole === "owner") {
                        html += '<option value="coowner"' + (u.role === "coowner" ? " selected" : "") + '>–ú–ª.–û–≤–Ω–µ—Ä</option>';
                        html += '<option value="owner"' + (u.role === "owner" ? " selected" : "") + '>Owner</option>';
                    }
                    html += '</select>';
                    html += '<button class="btn" onclick="changeRole(\'' + safeUN + '\')" style="font-size:10px;padding:2px 6px;">–†–æ–ª—å</button> ';
                }

                html += '<select id="dur-sel-' + safeUN + '">';
                html += '<option value="1800">30 –º–∏–Ω</option>';
                html += '<option value="3600">1 —á–∞—Å</option>';
                html += '<option value="7200">2 —á–∞—Å–∞</option>';
                html += '<option value="43200">12 —á–∞—Å–æ–≤</option>';
                html += '<option value="86400">1 –¥–µ–Ω—å</option>';
                if (currentRole === "admin" || currentRole === "owner" || currentRole === "coowner") {
                    html += '<option value="604800">7 –¥–Ω–µ–π</option>';
                    html += '<option value="2592000">30 –¥–Ω–µ–π</option>';
                    html += '<option value="99999999">–ù–∞–≤—Å–µ–≥–¥–∞</option>';
                }
                html += '</select>';

                if (!isBanned) {
                    html += '<button class="btn btn-danger" onclick="doBan(\'' + safeUN + '\')" style="font-size:10px;padding:2px 6px;">–ë–∞–Ω</button>';
                } else {
                    html += '<button class="btn btn-success" onclick="doUnban(\'' + safeUN + '\')" style="font-size:10px;padding:2px 6px;">–†–∞–∑–±–∞–Ω</button>';
                }
                if (!isMuted) {
                    html += '<button class="btn btn-warn" onclick="doMute(\'' + safeUN + '\')" style="font-size:10px;padding:2px 6px;">–ú—É—Ç</button>';
                } else {
                    html += '<button class="btn btn-success" onclick="doUnmute(\'' + safeUN + '\')" style="font-size:10px;padding:2px 6px;">–†–∞–∑–º—É—Ç</button>';
                }
                // Owner/coowner can delete accounts
                if ((currentRole === "owner" || currentRole === "coowner") && safeUN !== esc(currentUser)) {
                    html += '<button class="btn btn-danger" onclick="confirmDeleteUser(\'' + safeUN + '\')" style="font-size:10px;padding:2px 6px;" title="–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>';
                }
                html += '</div>';
            }
            list.innerHTML = html;
        }

        async function loadAdminUsers() {
            const data = await api("GET", "/api/users");
            if (data.error) { showStatus(data.error, "error"); document.getElementById("admin-users-list").innerHTML = '<div class="online-count" style="color:#c00;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + esc(data.error) + '</div>'; return; }
            allAdminUsers = data.users || [];
            filterAdminUsers();
        }

        async function changeRole(username) {
            const role = document.getElementById("role-sel-" + username).value;
            const data = await api("POST", "/api/admin/role", { username, role });
            if (data.error) { showStatus(data.error, "error"); return; }
            showStatus("–†–æ–ª—å " + username + " –∏–∑–º–µ–Ω–µ–Ω–∞!", "success");
            loadAdminUsers();
        }

        async function doBan(username) {
            const duration = document.getElementById("dur-sel-" + username).value;
            const data = await api("POST", "/api/admin/ban", { username, duration: parseInt(duration) });
            if (data.error) { showStatus(data.error, "error"); return; }
            // –°–Ω—è—Ç—å —Ä–æ–ª—å –º–æ–¥–µ—Ä–∞/–∞–¥–º–∏–Ω–∞ –ø—Ä–∏ –±–∞–Ω–µ (–Ω–æ –Ω–µ vip/owner/coowner)
            const u = allAdminUsers.find(x => x.username === username);
            if (u && (u.role === "moder" || u.role === "admin")) {
                await api("POST", "/api/admin/role", { username, role: "player" });
                showStatus(username + " –∑–∞–±–∞–Ω–µ–Ω! –†–æ–ª—å " + u.role + " —Å–Ω—è—Ç–∞.", "success");
            } else {
                showStatus(username + " –∑–∞–±–∞–Ω–µ–Ω!", "success");
            }
            loadAdminUsers();
        }

        async function doUnban(username) {
            await api("POST", "/api/admin/unban", { username });
            showStatus(username + " —Ä–∞–∑–±–∞–Ω–µ–Ω!", "success");
            loadAdminUsers();
        }

        async function doMute(username) {
            const duration = document.getElementById("dur-sel-" + username).value;
            const data = await api("POST", "/api/admin/mute", { username, duration: parseInt(duration) });
            if (data.error) { showStatus(data.error, "error"); return; }
            showStatus(username + " –∑–∞–º—å—é—á–µ–Ω!", "success");
            loadAdminUsers();
        }

        async function doUnmute(username) {
            await api("POST", "/api/admin/unmute", { username });
            showStatus(username + " —Ä–∞–∑–º—å—é—á–µ–Ω!", "success");
            loadAdminUsers();
        }

        // ========== DELETE ACCOUNT ==========
        let _deleteTarget = null;
        let _deleteSelf = false;

        function confirmDeleteSelf() {
            _deleteSelf = true;
            _deleteTarget = currentUser;
            document.getElementById("modal-delete-text").textContent = "–£–¥–∞–ª–∏—Ç—å —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç ¬´" + currentUser + "¬ª? –≠—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ. –í—Å–µ –ø–æ—Å—Ç—ã –∏ –¥–∞–Ω–Ω—ã–µ –∏—Å—á–µ–∑–Ω—É—Ç –Ω–∞–≤—Å–µ–≥–¥–∞.";
            document.getElementById("modal-delete-confirm").onclick = executeDelete;
            document.getElementById("modal-delete").classList.add("active");
        }

        function confirmDeleteUser(username) {
            _deleteSelf = false;
            _deleteTarget = username;
            document.getElementById("modal-delete-text").textContent = "–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç ¬´" + username + "¬ª? –í—Å–µ –ø–æ—Å—Ç—ã –∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –Ω–∞–≤—Å–µ–≥–¥–∞.";
            document.getElementById("modal-delete-confirm").onclick = executeDelete;
            document.getElementById("modal-delete").classList.add("active");
        }

        function closeModal() {
            document.getElementById("modal-delete").classList.remove("active");
            _deleteTarget = null;
        }

        async function executeDelete() {
            closeModal();
            if (!_deleteTarget) return;
            const data = await api("POST", "/api/admin/delete_user", { username: _deleteTarget });
            if (data.error) { showStatus(data.error, "error"); return; }
            if (_deleteSelf) {
                showStatus("–ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª—ë–Ω. –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!", "success");
                await doLogout();
            } else {
                showStatus("–ê–∫–∫–∞—É–Ω—Ç " + _deleteTarget + " —É–¥–∞–ª—ë–Ω!", "success");
                loadAdminUsers();
            }
        }

        // ========== SEARCH ==========
        async function doSearch() {
            const q = document.getElementById("search-query").value.trim();
            if (!q) { showStatus("–í–≤–µ–¥–∏ –∏–º—è –¥–ª—è –ø–æ–∏—Å–∫–∞!", "error"); return; }
            const data = await api("GET", "/api/users");
            if (data.error) { showStatus(data.error, "error"); return; }
            const results = (data.users || []).filter(u =>
                u.username.toLowerCase().includes(q.toLowerCase()) ||
                (u.nickname || "").toLowerCase().includes(q.toLowerCase())
            );
            const container = document.getElementById("search-results");
            if (!results.length) {
                container.innerHTML = '<div class="form-box"><p style="color:#888;text-align:center;">–ò–≥—Ä–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω</p></div>';
                return;
            }
            let html = '<div class="section-header" style="border-radius:8px;margin-top:8px;">üë§ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ (' + results.length + ')</div>';
            for (const u of results) {
                const now = Date.now() / 1000;
                const isBanned = u.ban_until > now;
                html += '<div class="admin-row" style="background:var(--card);padding:8px 12px;border:1px solid var(--border);border-radius:6px;margin:4px 0;">';
                html += avatarImg(u.avatar) + ' ';
                html += '<a onclick="viewProfile(\'' + esc(u.username) + '\')" style="font-weight:bold;cursor:pointer;">' + esc(u.username) + '</a> ';
                if (u.nickname && u.nickname !== u.username) html += '<span style="color:#666;">(' + esc(u.nickname) + ')</span> ';
                html += roleBadge(u.role) + ' ';
                if (isBanned) html += '<span class="ban-status ban-active">–ó–ê–ë–ê–ù–ï–ù</span>';
                html += '</div>';
            }
            container.innerHTML = html;
        }

        // ========== UTILS ==========
        function esc(str) {
            if (!str) return "";
            const d = document.createElement("div"); d.textContent = str; return d.innerHTML;
        }

        function readFileAsBase64(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.readAsDataURL(file);
            });
        }

        function openLightbox(src) {
            document.getElementById("lightbox-img").src = src;
            document.getElementById("lightbox").classList.add("active");
        }

        // ========== INIT ==========
        async function init() {
            const data = await api("GET", "/api/me");
            if (data.username) {
                setLoggedIn(data.username, data.role);
            } else {
                showPage("auth");
            }
        }
        init();

        setInterval(() => {
            if (document.getElementById("page-forum").style.display !== "none") loadPosts();
        }, 10000);
    </script>
</body>

</html>
